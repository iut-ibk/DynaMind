CMAKE_MINIMUM_REQUIRED(VERSION 2.6)
PROJECT(dynamind)
ADD_DEFINITIONS(-DDYNAMIND_VERSION_CORE="0.5.0")
OPTION(WITH_UNIT_TESTS "build unit tests" OFF)

FIND_PACKAGE(Qt4 COMPONENTS QtCore QtGui QtTest REQUIRED)
FIND_PACKAGE(GDAL)

OPTION(PYTHON_EMBEDDING "Embedding Python" ON)

SET(QT_USE_QTXML TRUE)
SET(QT_USE_QTTEST TRUE)

INCLUDE(${QT_USE_FILE})

IF(CMAKE_BUILD_TYPE STREQUAL Debug)
        MESSAGE(STATUS "Build Type = Debug")
        ADD_DEFINITIONS(-DDEBUG)
ELSE()
        MESSAGE(STATUS "Build Type = Release")
ENDIF()

IF(DYNAMIND_TOOLBOX_BUILD_DIR)
    SET(OUTPUT_DIR ${DYNAMIND_TOOLBOX_BUILD_DIR})
ELSE()
    SET(OUTPUT_DIR ${dynamind_BINARY_DIR})
ENDIF()

SET(LIBRARY_OUTPUT_PATH ${OUTPUT_DIR})
SET(EXECUTABLE_OUTPUT_PATH ${OUTPUT_DIR})
SET(SCRIPT_PATH ${OUTPUT_DIR}/PythonModules)

INCLUDE_DIRECTORIES(src/core ${QT_QTCORE_INCLUDE_DIR})

IF(PYTHON_EMBEDDING)
    FIND_PACKAGE(PythonLibs 2.7 REQUIRED)
    INCLUDE_DIRECTORIES(src/python-swig ${PYTHON_INCLUDE_PATH})
    FIND_PACKAGE(SWIG REQUIRED)
    INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_PATH})
ELSE()
    ADD_DEFINITIONS(-DPYTHON_EMBEDDING_DISABLED)
ENDIF()

ADD_SUBDIRECTORY(src/core)

IF(PYTHON_EMBEDDING)
    ADD_SUBDIRECTORY(src/python-swig)
ENDIF()

ADD_SUBDIRECTORY(src/DMTestModules)
ADD_SUBDIRECTORY(src/DMToolboxes)
ADD_SUBDIRECTORY(src/memory_test)
ADD_SUBDIRECTORY(scripts)

IF(WITH_UNIT_TESTS)
    ADD_SUBDIRECTORY(src/unit-test)
ENDIF(WITH_UNIT_TESTS)

IF(OPENMP_FOUND)
    SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${OpenMP_C_FLAGS}")
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}")
    SET(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} ${OpenMP_EXE_LINKER_FLAGS}")
ENDIF()


ADD_SUBDIRECTORY(CMake)

#INCLUDE(DynaMindCPack.txt)
